<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Analizza - ChessVerse</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<!-- Rimosso vecchio settings.css per evitare stili legacy che alterino il modal -->
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans',-apple-system,BlinkMacSystemFont,sans-serif}
body{background:#312e2b;color:#fff;-webkit-font-smoothing:antialiased}
a{text-decoration:none;color:inherit}
.header{background:#262522;border-bottom:1px solid #3d3d3d;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:sticky;top:0;z-index:50}
.logo{font-size:24px;font-weight:700;color:#8b4d8b}
.nav-links{display:flex;gap:24px}
.nav-links a{padding:8px 12px;font-size:14px;font-weight:500;color:#b9b9b9;border-radius:4px;transition:.15s}
.nav-links a:hover,.nav-links a.active{background:#3d3d3d;color:#fff}
.header-right{display:flex;gap:8px}
.btn{padding:10px 14px;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:.15s;font-size:14px;font-family:inherit}
.btn-primary{background:#8b4d8b;color:#fff}.btn-primary:hover{background:#7a427a}
.btn-secondary{background:#3d3d3d;color:#fff}.btn-secondary:hover{background:#4a4a4a}
.settings-btn{background:#3d3d3d;color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer;display:flex;align-items:center}
.settings-btn:hover{background:#4a4a4a}
.main{max-width:1250px;margin:0 auto;padding:24px 16px;display:flex;gap:28px;align-items:flex-start}
.board-wrapper{display:flex;flex-direction:column;gap:14px}
.board-container{position:relative}
.chessboard{--board-size:560px;width:var(--board-size);height:var(--board-size);display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);border:3px solid #8b4d8b;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.35);background:linear-gradient(135deg,var(--board-light,#f0d9b5) 0%,var(--board-dark,#b58863) 100%);overflow:hidden;position:relative}
.square{position:relative;display:flex;align-items:center;justify-content:center;user-select:none;cursor:pointer;font-size:0}
.square.light{background:var(--board-light,#f0d9b5)}.square.dark{background:var(--board-dark,#b58863)}
.piece{width:85%;height:85%;background-size:contain;background-repeat:no-repeat;background-position:center;z-index:10;cursor:grab;transition:transform .12s}
.piece:active{cursor:grabbing}
/* projected ghost piece shown on hover when a piece is selected */
.projected-piece{width:85%;height:85%;background-size:contain;background-repeat:no-repeat;background-position:center;opacity:1;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(.98);pointer-events:none;z-index:25}
/* When a premove is queued, hide the original piece at its origin so only the projected ghost is visible */
.square.premove-origin .piece{visibility:hidden}
/* Pezzi bianchi */
.piece.white.king { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22.5 11.63V6'/%3e%3cpath d='M20 8h5' stroke-linecap='butt'/%3e%3cpath d='M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5' fill='%23fff' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M11.5 37c5.5 3.5 15.5 3.5 21 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10V37z' fill='%23fff'/%3e%3cpath d='M11.5 30c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0' stroke='%23000'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.queen { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M8 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM24.5 7.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 8.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z'/%3e%3cpath d='M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15-5.5-13.5V25L7 14l2 12z' stroke-linecap='butt'/%3e%3cpath d='M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z' stroke-linecap='butt'/%3e%3cpath d='M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0' fill='none' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.rook { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M9 39h27v-3H9v3zM12 36v-4h21v4H12zM11 14V9h4v2h5V9h5v2h5V9h4v5' stroke-linecap='butt'/%3e%3cpath d='M34 14l-3 3H14l-3-3'/%3e%3cpath d='M31 17v12.5H14V17' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M31 29.5l1.5 2.5h-20l1.5-2.5'/%3e%3cpath d='M11 14h23' fill='none' stroke-linejoin='miter'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.bishop { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cg fill='%23fff' stroke-linecap='butt'%3e%3cpath d='M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2zM15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2zM25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z'/%3e%3c/g%3e%3cpath d='M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5' stroke-linejoin='miter'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.knight { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21' fill='%23fff'/%3e%3cpath d='M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3' fill='%23000'/%3e%3cpath d='M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0zM14.933 15.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z' fill='%23fff' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.pawn { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cpath d='M22.5 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38C17.33 16.5 16 18.59 16 21c0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z' fill='%23fff' stroke='%23000' stroke-width='1.5' stroke-linecap='round'/%3e%3c/svg%3e"); }
/* Pezzi neri */
.piece.black.king { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23000' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22.5 11.63V6' stroke='%23000'/%3e%3cpath d='M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5' fill='%23000' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M11.5 37c5.5 3.5 15.5 3.5 21 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10V37z' fill='%23000'/%3e%3cpath d='M20 8h5' stroke='%23000' stroke-linecap='butt'/%3e%3cpath d='M32 29.5s8.5-4 6.03-9.65C34.15 14 25 18 22.5 24.5l.01 2.1-.01-2.1C20 18 9.906 14 6.997 19.85c-2.497 5.65 4.853 9 6.853 9.65' stroke='%23fff'/%3e%3cpath d='M11.5 30c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.black.queen { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23000' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M8 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM24.5 7.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 8.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z'/%3e%3cpath d='M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15-5.5-13.5V25L7 14l2 12z' stroke-linecap='butt'/%3e%3cpath d='M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z' stroke-linecap='butt'/%3e%3cpath d='M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0' fill='none' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.black.rook { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23000' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M9 39h27v-3H9v3zM12.5 32l1.5-2.5h17l1.5 2.5h-20zM12 36v-4h21v4H12z' stroke-linecap='butt'/%3e%3cpath d='M14 29.5v-13h17v13H14z' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M14 16.5L11 14h23l-3 2.5H14zM11 14V9h4v2h5V9h5v2h5V9h4v5H11z' stroke-linecap='butt'/%3e%3cpath d='M12 35.5h21M13 31.5h19M14 29.5h17M14 16.5h17M11 14h23' fill='none' stroke='%23fff' stroke-width='1' stroke-linejoin='miter'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.black.bishop { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cg fill='%23000' stroke-linecap='butt'%3e%3cpath d='M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2zM15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2zM25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z'/%3e%3c/g%3e%3cpath d='M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5' stroke='%23fff' stroke-linejoin='miter'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.black.knight { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21' fill='%23000'/%3e%3cpath d='M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3' fill='%23000'/%3e%3cpath d='M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0zM14.933 15.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z' fill='%23fff' stroke='%23fff'/%3e%3cpath d='M24.55 10.4l-.45 1.45.5.15c3.15 1 5.65 2.49 7.9 6.75S35.75 29.06 35.25 39l-.05.5h2.25l.05-.5c.5-10.06-.88-16.85-3.25-21.34-2.37-4.49-5.79-6.64-9.19-7.16l-.51-.1z' fill='%23fff' stroke='none'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.black.pawn { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cpath d='M22.5 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38C17.33 16.5 16 18.59 16 21c0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z' fill='%23000' stroke='%23000' stroke-width='1.5' stroke-linecap='round'/%3e%3c/svg%3e"); }
.square.selected::before{content:"";position:absolute;inset:0;background:rgba(139,77,139,.25);box-shadow:inset 0 0 0 4px #8b4d8b;border-radius:4px;pointer-events:none;z-index:200}
.square.last-move:not(.selected)::before{content:"";position:absolute;inset:0;background:rgba(247,247,105,.35);pointer-events:none;z-index:5}
.square.last-move.highlight::before{display:none}
.square.possible-move:not(.occupied)::after{content:"";position:absolute;width:34%;height:34%;background:rgba(0,0,0,0.55);border-radius:50%;box-shadow:0 0 0 4px rgba(255,255,255,0.35);pointer-events:none;}
.square.possible-move.occupied::after{content:"";position:absolute;inset:0;box-shadow:inset 0 0 0 6px rgba(255,255,255,0.28),inset 0 0 0 12px rgba(139,77,139,0.35);background:rgba(255,255,255,0.10);border-radius:4px;pointer-events:none;}
.square.premove-origin::after{/* removed decorative circle for premove origin */}
.square.premove-target::after{/* removed decorative dot for premove target */}
.square.invalid{animation:shake .35s}
@keyframes shake{10%,90%{transform:translateX(-2px)}20%,80%{transform:translateX(4px)}30%,50%,70%{transform:translateX(-6px)}40%,60%{transform:translateX(6px)}}
#annotations-canvas{position:absolute;inset:0;pointer-events:none;z-index:900}
.square.arrow-remove-start::after{content:"";position:absolute;inset:0;box-shadow:inset 0 0 0 4px rgba(255,0,0,.65);border-radius:2px;pointer-events:none;z-index:900}
.game-status{background:#1a1a1a;border:1px solid #3d3d3d;border-radius:8px;padding:12px 16px;font-weight:500;font-size:14px;text-align:center;min-height:48px;display:flex;align-items:center;justify-content:center}
.side-panel{width:320px;display:flex;flex-direction:column;gap:22px}
.panel{background:#262421;border:1px solid #3d3d3d;border-radius:12px;padding:18px;display:flex;flex-direction:column;gap:14px}
.panel h3{margin:0;font-size:15px;font-weight:600;color:#fff;display:flex;align-items:center;gap:6px}
.bot-grid{display:flex;flex-wrap:wrap;gap:12px}
.bot-card{flex:1 1 130px;min-width:125px;background:#1f1d1b;border:2px solid #3d3d3d;border-radius:10px;padding:14px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;transition:.18s}
.bot-card:hover{border-color:#8b4d8b;transform:translateY(-3px)}.bot-card.selected{border-color:#8b4d8b;box-shadow:0 0 0 2px rgba(139,77,139,.4)}
.bot-icon{font-size:30px}
.level-selector{display:none;flex-direction:column;gap:10px;background:#1e1d1b;border:1px solid #3d3d3d;border-radius:10px;padding:14px}
.level-selector.visible{display:flex}
.level-indicator{background:#8b4d8b;color:#fff;font-size:12px;padding:2px 8px;border-radius:14px;font-weight:600}
.timer{display:none;grid-template-columns:1fr 1fr;gap:8px}
.timer.active{display:grid}
.clock{background:#1a1a1a;border:1px solid #3d3d3d;border-radius:10px;padding:12px 10px;display:flex;flex-direction:column;gap:4px;align-items:center;font-variant-numeric:tabular-nums}
.clock.active{border-color:#8b4d8b;box-shadow:0 0 0 1px #8b4d8b}
.clock .name{font-size:12px;opacity:.75;font-weight:600}
.clock .time{font-size:20px;font-weight:700}
.clock.low .time{color:#ffce54}.clock.flag .time{color:#ff5252}
.controls-row{display:flex;gap:10px;flex-wrap:wrap}
.promotion-grid{display:grid;grid-template-columns:repeat(4,60px);gap:10px;margin-top:12px}
.promo-choice{width:60px;height:60px;background:#1a1a1a;border:2px solid #3d3d3d;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:38px;cursor:pointer;transition:.18s}
.promo-choice:hover{border-color:#8b4d8b;background:#262626;transform:translateY(-3px)}
.dialog-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:6000}
.dialog{background:#262421;border:1px solid #3d3d3d;border-radius:14px;padding:24px 26px;min-width:320px;max-width:420px}
.dialog h3,.dialog h2{margin:0 0 6px;font-weight:700;color:#fff;font-size:18px}
.dialog p{margin:0 0 10px;font-size:13px;color:#cfcfcf}
.dialog button{background:#8b4d8b;color:#fff;border:none;border-radius:8px;padding:10px 14px;font-weight:600;cursor:pointer}
.dialog button:hover{background:#7a427a}
.dialog button.secondary{background:#3d3d3d}.dialog button.secondary:hover{background:#4a4a4a}
/* highlight dynamic style injected */
/* === SETTINGS OVERLAY (stile index) === */
#settingsOverlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;z-index:3000;overflow:auto;align-items:flex-start;justify-content:center;padding-top:60px;padding-bottom:60px}
#settingsOverlay .settings-modal{background:#262421;margin:0 auto;padding:24px;border-radius:12px;max-width:900px;width:90%;color:#fff;border:1px solid #3d3d3d}
.settings-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.settings-tabs{display:flex;gap:8px;margin-bottom:16px;flex-wrap:nowrap;align-items:center}
.settings-tab{padding:8px 14px;background:#3d3d3d;border-radius:6px;font-size:13px;cursor:pointer;font-weight:600;transition:.15s;flex:1;text-align:center}
.settings-tab.active,.settings-tab:hover{background:#8b4d8b;color:#fff}
.settings-tab{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.settings-panel{display:none;gap:16px;flex-wrap:wrap}
.settings-panel.active{display:flex}
.setting-item{flex:1 1 240px;background:#1f1f1f;border:1px solid #3d3d3d;padding:12px 14px;border-radius:10px;display:flex;flex-direction:column;gap:8px;min-width:220px}
.setting-item h4{font-size:14px;margin:0;font-weight:600;color:#fff}
.setting-item small{font-size:11px;color:#b9b9b9}
.setting-item input[type=range]{width:100%}
.toggle{width:44px;height:24px;border-radius:20px;background:#555;position:relative;cursor:pointer;transition:.2s}
.toggle::after{content:"";position:absolute;width:20px;height:20px;background:#fff;border-radius:50%;top:2px;left:2px;transition:.2s}
.toggle.active{background:#8b4d8b}
.toggle.active::after{transform:translateX(20px)}
/* Ensure toggles in settings modal receive pointer events and sit above overlays */
#settingsOverlay .toggle{position:relative;z-index:3101;pointer-events:auto}
select,input[type=color]{background:#2c2c2c;color:#fff;border:1px solid #555;padding:6px 8px;border-radius:6px;font-family:inherit}
.close-btn{background:#3d3d3d;border:none;color:#fff;padding:4px 8px;border-radius:5px;cursor:pointer;font-size:12px;line-height:1.1}
.close-btn:hover{background:#555}
/* Evidenzia layer frecce attivo */
.arrow-layer-active{background:#8b4d8b!important;color:#fff!important}
@media (max-width:620px){.settings-tabs{flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch}.settings-tab{flex:0 0 auto}}
</style>
</head>
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Analizza - ChessVerse</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<!-- Rimosso vecchio settings.css per evitare stili legacy che alterino il modal -->
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans',-apple-system,BlinkMacSystemFont,sans-serif}
body{background:#312e2b;color:#fff;-webkit-font-smoothing:antialiased}
a{text-decoration:none;color:inherit}
.header{background:#262522;border-bottom:1px solid #3d3d3d;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:sticky;top:0;z-index:50}
.logo{font-size:24px;font-weight:700;color:#8b4d8b}
.nav-links{display:flex;gap:24px}
.nav-links a{padding:8px 12px;font-size:14px;font-weight:500;color:#b9b9b9;border-radius:4px;transition:.15s}
.nav-links a:hover,.nav-links a.active{background:#3d3d3d;color:#fff}
.header-right{display:flex;gap:8px}
.btn{padding:10px 14px;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:.15s;font-size:14px;font-family:inherit}
.btn-primary{background:#8b4d8b;color:#fff}.btn-primary:hover{background:#7a427a}
.btn-secondary{background:#3d3d3d;color:#fff}.btn-secondary:hover{background:#4a4a4a}
.settings-btn{background:#3d3d3d;color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer;display:flex;align-items:center}
.settings-btn:hover{background:#4a4a4a}
.main{max-width:1250px;margin:0 auto;padding:24px 16px;display:flex;gap:28px;align-items:flex-start}
.board-wrapper{display:flex;flex-direction:column;gap:14px}
.board-container{position:relative}
.chessboard{--board-size:560px;width:var(--board-size);height:var(--board-size);display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);border:3px solid #8b4d8b;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.35);background:linear-gradient(135deg,var(--board-light,#f0d9b5) 0%,var(--board-dark,#b58863) 100%);overflow:hidden;position:relative}
.square{position:relative;display:flex;align-items:center;justify-content:center;user-select:none;cursor:pointer;font-size:0}
.square.light{background:var(--board-light,#f0d9b5)}.square.dark{background:var(--board-dark,#b58863)}
.piece{width:85%;height:85%;background-size:contain;background-repeat:no-repeat;background-position:center;z-index:10;cursor:grab;transition:transform .12s}
.piece:active{cursor:grabbing}
/* projected ghost piece shown on hover when a piece is selected */
.projected-piece{width:85%;height:85%;background-size:contain;background-repeat:no-repeat;background-position:center;opacity:1;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(.98);pointer-events:none;z-index:25}
/* When a premove is queued, hide the original piece at its origin so only the projected ghost is visible */
.square.premove-origin .piece{visibility:hidden}
/* Pezzi bianchi */
.piece.white.king { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22.5 11.63V6'/%3e%3cpath d='M20 8h5' stroke-linecap='butt'/%3e%3cpath d='M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5' fill='%23fff' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M11.5 37c5.5 3.5 15.5 3.5 21 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10V37z' fill='%23fff'/%3e%3cpath d='M11.5 30c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0' stroke='%23000'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.queen { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M8 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM24.5 7.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM16 8.5a2 2 0 1 1-4 0 2 2 0 1 1 4 0zM33 9a2 2 0 1 1-4 0 2 2 0 1 1 4 0z'/%3e%3cpath d='M9 26c8.5-1.5 21-1.5 27 0l2-12-7 11V11l-5.5 13.5-3-15-3 15-5.5-13.5V25L7 14l2 12z' stroke-linecap='butt'/%3e%3cpath d='M9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z' stroke-linecap='butt'/%3e%3cpath d='M11.5 30c3.5-1 18.5-1 22 0M12 33.5c6-1 15-1 21 0' fill='none' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.rook { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M9 39h27v-3H9v3zM12 36v-4h21v4H12zM11 14V9h4v2h5V9h5v2h5V9h4v5' stroke-linecap='butt'/%3e%3cpath d='M34 14l-3 3H14l-3-3'/%3e%3cpath d='M31 17v12.5H14V17' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M31 29.5l1.5 2.5h-20l1.5-2.5'/%3e%3cpath d='M11 14h23' fill='none' stroke-linejoin='miter'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.bishop { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cg fill='%23fff' stroke-linecap='butt'%3e%3cpath d='M9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2zM15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2zM25 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 1 1 5 0z'/%3e%3c/g%3e%3cpath d='M17.5 26h10M15 30h15m-7.5-14.5v5M20 18h5' stroke-linejoin='miter'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.knight { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22 10c10.5 1 16.5 8 16 29H15c0-9 10-6.5 8-21' fill='%23fff'/%3e%3cpath d='M24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4.003 1-4-4 0-2 6-12 6-12s1.89-1.9 2-3.5c-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2s.78-1.992 2.5-3c1 0 1 3 1 3' fill='%23000'/%3e%3cpath d='M9.5 25.5a.5.5 0 1 1-1 0 .5.5 0 1 1 1 0zM14.933 15.75a.5 1.5 30 1 1-.866-.5.5 1.5 30 1 1 .866.5z' fill='%23fff' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
.piece.white.pawn { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cpath d='M22.5 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38C17.33 16.5 16 18.59 16 21c0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z' fill='%23fff' stroke='%23000' stroke-width='1.5' stroke-linecap='round'/%3e%3c/svg%3e"); }
/* Pezzi neri */
.piece.black.king { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3e%3cg fill='%23000' fill-rule='evenodd' stroke='%23000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='M22.5 11.63V6' stroke='%23000'/%3e%3cpath d='M22.5 25s4.5-7.5 3-10.5c0 0-1-2.5-3-2.5s-3 2.5-3 2.5c-1.5 3 3 10.5 3 10.5' fill='%23000' stroke-linecap='butt' stroke-linejoin='miter'/%3e%3cpath d='M11.5 37c5.5 3.5 15.5 3.5 21 0v-7s9-4.5 6-10.5c-4-6.5-13.5-3.5-16 4V27v-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10V37z' fill='%23000'/%3e%3cpath d='M20 8h5' stroke='%23000' stroke-linecap='butt'/%3e%3cpath d='M32 29.5s8.5-4 6.03-9.65C34.15 14 25 18 22.5 24.5l.01 2.1-.01-2.1C20 18 9.906 14 6.997 19.85c-2.497 5.65 4.853 9 6.853 9.65' stroke='%23fff'/%3e%3cpath d='M11.5 30c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0' stroke='%23fff'/%3e%3c/g%3e%3c/svg%3e"); }
... (rest of bot.html identical content preserved)
</style>
</head>
<body>
<header class="header">
  <div class="header-left" style="display:flex;align-items:center;gap:32px;">
    <a href="/" class="logo">ChessVerse</a>
    <nav class="nav-links">
      <a href="/play">Gioca Online</a>
      <a href="/bot">Bot Arena</a>
      <a href="/analysis" class="active">Analizza</a>
    </nav>
  </div>
  <div class="header-right">
    <button class="settings-btn" onclick="openSettings()" title="Impostazioni">⚙</button>
    <button class="btn btn-primary">Accedi</button>
  </div>
</header>
<main class="main" style="align-items:center;justify-content:center;">
  <section style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;max-width:760px;width:100%;">
    <a href="/analysis/board" class="bot-card" style="display:flex;flex-direction:column;align-items:flex-start;gap:10px;padding:22px;">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="bot-icon">♟️</div>
        <div style="font-weight:700;font-size:16px">Analysis Board</div>
      </div>
      <div style="color:#cfcfcf;font-size:13px">Apri la scacchiera completa per setup, self-play, import/export FEN e reset.</div>
    </a>

    <a href="/analysis/review" class="bot-card" style="display:flex;flex-direction:column;align-items:flex-start;gap:10px;padding:22px;">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="bot-icon">📄</div>
        <div style="font-weight:700;font-size:16px">Review Board</div>
      </div>
      <div style="color:#cfcfcf;font-size:13px">Apri la modalità review per analisi passiva e navigazione delle mosse (nessun engine attivo).</div>
    </a>
  </section>
</main>

<footer style="text-align:center;padding:24px;color:#b9b9b9">Scegli una modalità per iniziare l'analisi.</footer>

</body>
</html>